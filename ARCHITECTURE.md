# Архитектура системы семантического поиска

## Обзор

Система семантического поиска построена на основе векторной модели поиска с использованием TF-IDF (Term Frequency-Inverse Document Frequency) для оценки релевантности документов.

## Компоненты системы

### 1. TextProcessor (`core/text_processor.py`)
**Назначение**: Обработка и нормализация текста

**Основные функции**:
- `preprocess_text()` - основная функция обработки текста
- `extract_keywords()` - извлечение ключевых слов
- `normalize_query()` - нормализация запросов

**Процесс обработки**:
1. Приведение к нижнему регистру
2. Удаление лишних символов (только русские буквы и пробелы)
3. Удаление множественных пробелов
4. Удаление стоп-слов
5. Простой стемминг (удаление окончаний)
6. Фильтрация коротких слов

### 2. DocumentManager (`utils/document_manager.py`)
**Назначение**: Управление документами и их метаданными

**Основные классы**:
- `Document` - представление документа
- `DocumentManager` - менеджер документов

**Функциональность**:
- Добавление/удаление документов
- Сохранение/загрузка из JSON файла
- Поиск по заголовку
- Статистика документов

### 3. DocumentIndex (`core/document_indexer.py`)
**Назначение**: Индексация документов для быстрого поиска

**Структуры данных**:
- `inverted_index` - инвертированный индекс (слово → {doc_id: tf})
- `forward_index` - прямой индекс (doc_id → {слово: tf})
- `document_lengths` - длины документов
- `tf_idf_weights` - TF-IDF веса

**Алгоритмы**:
- TF (Term Frequency) - частота термина в документе
- IDF (Inverse Document Frequency) - обратная частота документа
- TF-IDF - произведение TF и IDF
- Косинусное сходство для ранжирования

### 4. SearchEngine (`core/search_engine.py`)
**Назначение**: Основной поисковый движок

**Основные классы**:
- `SearchResult` - результат поиска с фрагментом
- `SearchEngine` - основной движок

**Функциональность**:
- Семантический поиск по содержимому
- Поиск по заголовку
- Генерация фрагментов результатов
- Статистика системы
- Предложение ключевых слов

## Алгоритм поиска

### 1. Индексация документов
```
Для каждого документа:
1. Обработать текст (TextProcessor)
2. Создать вектор TF-IDF
3. Обновить инвертированный индекс
4. Сохранить в прямом индексе
```

### 2. Поиск по запросу
```
1. Обработать запрос (TextProcessor)
2. Создать вектор запроса
3. Вычислить косинусное сходство с каждым документом
4. Отсортировать по убыванию релевантности
5. Вернуть топ-K результатов
```

### 3. Формулы

**TF (Term Frequency)**:
```
tf(t,d) = count(t,d) / |d|
где count(t,d) - количество вхождений термина t в документ d
|d| - общее количество слов в документе d
```

**IDF (Inverse Document Frequency)**:
```
idf(t) = log(|D| / |{d ∈ D : t ∈ d}|)
где |D| - общее количество документов
|{d ∈ D : t ∈ d}| - количество документов, содержащих термин t
```

**TF-IDF**:
```
tf-idf(t,d) = tf(t,d) × idf(t)
```

**Косинусное сходство**:
```
cos(q,d) = (q · d) / (||q|| × ||d||)
где q - вектор запроса, d - вектор документа
```

## Структура данных

### Инвертированный индекс
```
{
  "слово1": {
    "doc_1": tf_value,
    "doc_2": tf_value,
    ...
  },
  "слово2": {
    "doc_1": tf_value,
    "doc_3": tf_value,
    ...
  }
}
```

### Прямой индекс
```
{
  "doc_1": {
    "слово1": tf_value,
    "слово2": tf_value,
    ...
  },
  "doc_2": {
    "слово1": tf_value,
    "слово3": tf_value,
    ...
  }
}
```

## Примеры работы

### Обработка запроса "искусственный интеллект"
1. **Предобработка**: "искусственн интеллект"
2. **Вектор запроса**: {"искусственн": 1.0, "интеллект": 1.0}
3. **Поиск совпадений**: Документы с этими словами
4. **Вычисление сходства**: TF-IDF веса для каждого документа
5. **Ранжирование**: Сортировка по убыванию сходства

### Результат поиска
```
1. Искусственный интеллект и машинное обучение
   Релевантность: 0.1898
   Ключевые слова: искусственн, интеллект
   Фрагмент: Искусственный интеллект (ИИ) — это область...
```

## Преимущества архитектуры

1. **Модульность**: Каждый компонент решает свою задачу
2. **Расширяемость**: Легко добавлять новые функции
3. **Производительность**: Индексация позволяет быстрый поиск
4. **Точность**: TF-IDF обеспечивает хорошее ранжирование
5. **Гибкость**: Поддержка различных типов поиска

## Ограничения

1. **Простой стемминг**: Менее точный чем лемматизация
2. **Нет синонимов**: Не учитывает семантические связи
3. **Память**: Хранение всех индексов в памяти
4. **Обновления**: Переиндексация при изменении документов

## Возможные улучшения

1. **Лемматизация**: Использование морфологического анализа
2. **Синонимы**: Расширение запросов синонимами
3. **Векторные модели**: Word2Vec, BERT для семантического поиска
4. **Персистентность**: Сохранение индексов на диск
5. **Кэширование**: Кэш результатов поиска
6. **Параллелизм**: Многопоточная обработка

